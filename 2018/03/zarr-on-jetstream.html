<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Use the distributed file format Zarr on Jetstream Swift object storage | Andrea Zonca</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Use the distributed file format Zarr on Jetstream Swift object storage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Zarr" />
<meta property="og:description" content="Zarr" />
<link rel="canonical" href="https://zonca.dev/2018/03/zarr-on-jetstream.html" />
<meta property="og:url" content="https://zonca.dev/2018/03/zarr-on-jetstream.html" />
<meta property="og:site_name" content="Andrea Zonca" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-03T18:00:00-06:00" />
<script type="application/ld+json">
{"headline":"Use the distributed file format Zarr on Jetstream Swift object storage","dateModified":"2018-03-03T18:00:00-06:00","datePublished":"2018-03-03T18:00:00-06:00","description":"Zarr","mainEntityOfPage":{"@type":"WebPage","@id":"https://zonca.dev/2018/03/zarr-on-jetstream.html"},"@type":"BlogPosting","url":"https://zonca.dev/2018/03/zarr-on-jetstream.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://zonca.dev/feed.xml" title="Andrea Zonca" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Use the distributed file format Zarr on Jetstream Swift object storage | Andrea Zonca</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Use the distributed file format Zarr on Jetstream Swift object storage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Zarr" />
<meta property="og:description" content="Zarr" />
<link rel="canonical" href="https://zonca.dev/2018/03/zarr-on-jetstream.html" />
<meta property="og:url" content="https://zonca.dev/2018/03/zarr-on-jetstream.html" />
<meta property="og:site_name" content="Andrea Zonca" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-03T18:00:00-06:00" />
<script type="application/ld+json">
{"headline":"Use the distributed file format Zarr on Jetstream Swift object storage","dateModified":"2018-03-03T18:00:00-06:00","datePublished":"2018-03-03T18:00:00-06:00","description":"Zarr","mainEntityOfPage":{"@type":"WebPage","@id":"https://zonca.dev/2018/03/zarr-on-jetstream.html"},"@type":"BlogPosting","url":"https://zonca.dev/2018/03/zarr-on-jetstream.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://zonca.dev/feed.xml" title="Andrea Zonca" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Andrea Zonca</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Use the distributed file format Zarr on Jetstream Swift object storage</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2018-03-03T18:00:00-06:00" itemprop="datePublished">
        Mar 3, 2018
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      1 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#jupyter">jupyter</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#jetstream">jetstream</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#zarr">zarr</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="zarr">Zarr</h2>

<p>Zarr is a pretty new file format designed for cloud computing, see <a href="http://zarr.readthedocs.io">documentation</a> and <a href="https://www.youtube.com/watch?v=np_p4JBAIYI">a webinar</a> for more details.</p>

<p>Zarr is also supported by <a href="http://dask.pydata.org">dask</a>, the parallel computing framework for Dask,
and the Dask team implemented storage backends for <a href="https://github.com/dask/gcsfs">Google Cloud Storage</a> and
<a href="https://github.com/dask/s3fs">Amazon S3</a>.</p>

<h2 id="use-openstack-swift-on-jetstream-for-object-storage">Use OpenStack swift on Jetstream for object storage</h2>

<p>Jetstream also offers (currently in beta) access to object storage via OpenStack Swift.
This is a separate service from the Jetstream Virtual Machines, so you do not need to spin
any Virtual Machine dedicated to storing the data but just use the object storage already
provided by Jetstream.</p>

<h2 id="read-zarr-files-from-object-store">Read Zarr files from object store</h2>

<p>If somebody else has already made available some files on object store and set their visibility
to “public”, anybody can read them.</p>

<p>See this notebook</p>

<p>Need openstack RC file version 3 from: <a href="https://iu.jetstream-cloud.org/project/api_access/">https://iu.jetstream-cloud.org/project/api_access/</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install python-openstackclient
</code></pre></div></div>

<p>source the openstackRC file, put the password, this is the TACC password, NOT the XSEDE Password. I know.</p>

<p>now create ec2 credentials with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack ec2 credentials create -f json &gt; ec2.json
</code></pre></div></div>

<p>test if we can access this.</p>

<p>I installed this on <code class="highlighter-rouge">js-169-169</code></p>

<p>actually we can skip ec2 credentials and just use openstack:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack object list zarr_pangeo
</code></pre></div></div>

<p>save credentials in <code class="highlighter-rouge">~/.aws/config</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[default]
region=RegionOne
aws_access_key_id=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
aws_secret_access_key=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import s3fs
fs = s3fs.S3FileSystem(client_kwargs=dict(endpoint_url="https://iu.jetstream-cloud.org:8080"))
fs.ls("zarr_pangeo")
</code></pre></div></div>

<p>Zarr with dask on 1 node works fine</p>

<p>https://gist.github.com/zonca/071bbd8cbb9d15b1789865acb9e66de8</p>

<p>Need to test:</p>
<ul>
  <li>access from multiple nodes with distributed</li>
  <li>test read-only access without authentication</li>
</ul>

  </div><a class="u-url" href="/2018/03/zarr-on-jetstream.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Tutorials and blog posts by Andrea Zonca: Python, Jupyter, Kubernetes</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/zonca" title="zonca"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/andreazonca" title="andreazonca"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
